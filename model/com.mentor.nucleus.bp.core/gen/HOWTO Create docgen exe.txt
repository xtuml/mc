Running DocGen
--------------
- To run DocGen inside Verifier
  o Create src/lib/
  o Copy libsrc/*.java to src/lib/
  o Build the project with the Java Builder only
  o Check out <SVN>/trunk/Models/Test/DocGenTest
  o Create a Model Verifier Application launch configuration for the bp.core project
  o Run this launch config
  o In session explorer, expand bp.core/ooaofooa/DocGen
  o Execute docgen_load_project
  o Execute docgen
  o doc.xml will be created in the gen/ folder of the project
  
  NOTE: You can use other models, but they must be a sibling to the bp.core 
        project in the workspace and they must be (re)named DocGenTest or you 
        must modify docgen_load_project for the model name you want to use.
  NOTE2: doc.xml is appended to each time docgen is run.  You must manually
         delete it between runs.
               
- If you need to run docgen.exe by hand for testing, build your sample model
  with MC3020, this will give you gen/code_generation/_system.sql
  o To debug with CDT inside eclipse, copy this _system.sql to 
    com.mentor.nucleus.bp.core/a.xtuml, then create a debug launch configuration
    of type C/C++ Application that points to Debug/docgen.exe
  o To run via the command line, copy this _system.sql to a.xtuml as a directory
    sibling of docgen.exe, then just execute ./docgen.exe





Building mcmc (which serves to be both mcmc and docgen).
-------------

Summary:
- Convert RSL queries into OAL and import into model of model compiler.
- Convert RSL templates into C code templates.
- Build dynamic template engine.
- Generate C code from model compiler model.
- Compile and link.

Needed:
- Linux BridgePoint with source MC installed
- Enable preference:  Allow operations inside where clauses of select statements
- Copy <git>/xtuml/mc/etc/com.mentor.nucleus.bp.core.function.gen_*.jar to your installation's dropins/ folder
- xtuml/mc/model/com.mentor.nucleus.bp.core
- rsl2oal (lives in xtuml/mc/mcmc/arlan)
- current_list.sh (lives in xtuml/mc/mcmc/arlan)
- convert_templates.sh (lives in xtuml/mc/mcmc/arlan)
- golden source from previous build (xtuml/mc/model/com.mentor.nucleus.bp.core/src410)
- flex (>=2.5.35) & bison (>=2.5)

Update the RSL-to-OAL translator.
- Create function signatures for OAL from the RSL by running the
  the following in the mc/arc folder:
  + egrep -r -e "^\.function " -e "^ *\.param " -e ".end function" * | awk '{if ($1 ~ ".function") printf("{\"%s\"",$2); else if ($0 ~ "\.param ") printf(",\"%s\"",$4); else if ($1 ~ ".end" && $2 ~ "function") printf("},\n");}' > ~/funcsigs.h
  + Then, vimdiff ~/funcsigs.h ../mcmc/arlan/funcsigs.h (Or use a sissy GUI diff'er like "meld").  Copy relevant updates into the arlan/ based file.
  + In the mc/mcmc/arlan/ folder: make -f makefile.rsl2oal

Run the rsl2oal translator.
- Translate RSL to OAL:
  + Copy old o*.oal to a backup location (in /tmp/).
  + sh ./current_list.sh
  + diff with old version of o.oal, o2.oal, o3.oal, o4.oal looking for extra
    blank space.  (Clean up that extra blank space.)
- In the MC model, delete functions from afun, afunmark, afunsmt, afunval
  but leave afun::a0.
- Next we create OAL functions from the RSL data.  For each function package
  below, Right-click on the Function Package > BridgePoint Utilities > "Generate Functions from List...":
  + afun gets o.oal
  + afunval gets o2.oal
  + afunsmt gets o3.oal
  + afunmark gets o4.oal
  Parse all activities.  Fix the following by hand-editing:
    afunstmt > smt_select_related: Change ${subtypecheck}\ to subtypecheck in 5 or 6 places
    afunstmt > smt_select_related: Change ${ws}{\ to ws + "{"
    afunstmt > smt_select_related: Change }\ to "}"
    afunmark > T_atoi:  STRING_TO_INTEGER // Comment this out and return 0.

Update the template engine.
- In the mc/mcmc/arlan/ folder: make -f makefile.template
- Copy lex.yy.c, template_engine.tab.c and y.tab.h to ../../model/com.mentor.nucleus.bp.core/gen folder
- mkdir ../../model/com.mentor.nucleus.bp.core/src/c
- sh ./convert_templates.sh to translate RSL templates into C code templates.

Generate the code.
- In BP project com.mentor.nucleus.bp.core, Build Project
- The following diffs come from files in the gen folder.  Verify the following 6
  changes are now in the src/ folder.
  + Edit ooaofooa_TE_ABA_class.h:
    c_t * code;
  + Edit ooaofooa_TE_BLK_class.h:
    c_t declaration[16000];
    c_t deallocation[8000];
  + Edit ooaofooa_TE_SMT_class.h:
    c_t buffer[2500];
- Add back in the attributes at the end of the TE_C class.  Make sure to transfer all places where changes need to come across.
  + vimdiff ../src410/ooaofooa_TE_C_class.c ooaofooa_TE_C_class.c:
- Remove an extraneous line feed in 2 templates.
  + vimdiff ../src410/c/t.smt_sr.multi_many_astob1.c c/t.smt_sr.multi_many_astob1.c
  + vimdiff ../src410/c/t.smt_sr.multi_many_astobm.c c/t.smt_sr.multi_many_astobm.c
- Copy gen/docbook_h to src/docbook.

Compile the code.
Note that the Linux version will have the template parser linked in.  It is
not worth keeping a DOS flex library prepared to link in.  So, yywrap.c compiles
to a dummy routine to satisfy the link for Windows.
- cd com.mentor.nucleus.bp.core/src
- i686-w64-mingw32-gcc -DTEMPLATE_ENGINE -Wno-pointer-to-int-cast *.c -o mcmc
- gcc -DTEMPLATE_ENGINE -Wno-pointer-to-int-cast *.c -lfl -o mcmc


